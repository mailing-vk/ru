function log(e){console.log(e)}function Random(e,t){return Math.floor(Math.random()*(t-e+1))+e}function tokens(e){localStorage.setItem("tokens",JSON.stringify(e))}function new_token(){let e=document.querySelector(".form");document.querySelector(".error").style.display="none","none"==getComputedStyle(e).display?e.style.display="block":e.style.display="none",list_tokens()}function delete_token(){let e=document.querySelector(".form_del");document.querySelector(".error").style.display="none","none"==getComputedStyle(e).display?e.style.display="block":e.style.display="none",list_tokens()}function add_token(){let e=document.forms.JoinStart,t=e.elements.token.value;t.length>85&&(t.indexOf("token=")>-1&&(t=t.slice(t.indexOf("token=")+6,t.length)),t.indexOf("&e")>-1&&(t=t.slice(0,t.indexOf("&e")))),$.ajax({url:`https://api.vk.com/method/users.get?fields=photo_50,last_seen&access_token=${t}&v=5.131`,method:"GET",dataType:"JSONP",success:function(e){if(e.error){document.querySelector(".error").style.display="block",document.querySelector(".error__p").innerHTML=`В результате проверки токена на валидность возникла ошибка: ${e.error.error_code}. ${e.error.error_msg}`}else{document.querySelector(".form").style.display="none",document.querySelector(".error").style.display="none";let n=e.response[0],s=JSON.parse(localStorage.getItem("tokens")),o=s.find(e=>e.id==n.id);o?(o.first_name=n.first_name,o.last_name=n.last_name,o.id=n.id,o.last_seen=n.last_seen.time,o.photo=n.photo_50,o.token=t,o.deactevated=!1):s.push({first_name:n.first_name,last_name:n.last_name,id:n.id,last_seen:n.last_seen.time,photo:n.photo_50,token:t,deactevated:!1}),tokens(s),list_tokens()}}}),e.elements.token.value="",list_tokens()}function del_token(){let e=document.forms.JoinStop,t=e.elements.token_del.value,n=JSON.parse(localStorage.getItem("tokens"));for(let e in n){let s=n[e];s.id!=Number(t)&&s.token!=t||n.splice(e,1)}e.elements.token_del.value="",delete_token(),tokens(n),list_tokens()}function list_tokens(){let e=JSON.parse(localStorage.getItem("tokens")),t="";for(let n in e){let s=e[n];t+=`<div class="users__content__item">\n      <div class="users__content__item-photo">\n         <img src="${s.photo}">\n      </div>\n      <div class="users__content__item-content">\n         <div class="name">\n            <a href="https://vk.com/id${s.id}">${s.first_name} ${s.last_name}</a>\n         </div>\n         <div class="token">${s.token}</div>\n      </div>\n   </div>`}document.querySelector(".users__content-list").innerHTML=t,t.length>1?document.querySelector(".users__content-not").style.display="none":document.querySelector(".users__content-not").style.display="block"}function number_active_day(){document.forms.UsersStart.elements.active.checked&&(document.querySelector("#active_day").style.display="block"),document.forms.UsersStart.elements.active.checked||(document.querySelector("#active_day").style.display="none")}function forma(){let e=document.forms.UsersStart,t=e.elements.uid.value,n=document.querySelector("#result_items"),s=JSON.parse(localStorage.getItem("tokens")),o="";t>0?$.ajax({url:`https://api.vk.com/method/friends.get?user_id=${t}&count=5000&fields=can_write_private_message,last_seen&access_token=${s[0].token}&v=5.131`,method:"GET",dataType:"JSONP",success:function(t){if(!t.error){let n=t.response.items;for(let t in n){let s=n[t];if(1==s.can_write_private_message)if(e.elements.active.checked)if(s.last_seen){let t=Math.round((new Date).getTime()/1e3);t-=86400*e.elements.active_day.value,t<s.last_seen.time&&(o+=s.id+"<br>")}else o+=s.id+"<br>";else o+=s.id+"<br>"}}n.innerHTML+=o}}):$.ajax({url:`https://api.vk.com/method/groups.getMembers?group_id=${-1*t}&fields=can_write_private_message,last_seen&access_token=${s[0].token}&v=5.131`,method:"GET",dataType:"JSONP",success:function(t){if(t.error);else{let n=t.response.items;for(let t in n){let s=n[t];1==s.can_write_private_message&&(e.elements.active.checked&&s.last_seen?Math.round((new Date).getTime()/1e3)-86400*e.elements.active_day.value<s.last_seen.time&&(o+=s.id+"<br>"):o+=s.id+"<br>")}}n.innerHTML+=o}}),setTimeout((function(){document.querySelector("#active_day").style.display="none",document.UsersStart.reset()}),1e3)}function new_text(){let e=document.querySelector(".sends__text");txt+=1,e.insertAdjacentHTML("beforeend",`<div class="textarea txt${txt}" tabindex="0" contenteditable="true" name="result_items" id="result_items" role="textbox" aria-multiline="true" required placeholder="Введите текст"></div>`)}function SendsStart(){let e=document.forms.Sends.elements.sends_users.value.split(" ");document.querySelector(".table-number1").innerText=e.length;let t=[];for(let e=0;txt>e;)e+=1,t.push(document.querySelector(".txt"+e).textContent);let n=JSON.parse(localStorage.getItem("tokens")),s=[];accounts=[];for(let e in n)accounts.push({id:n[e].id,messages:0});let o=0;for(let l in e){o+=2e4;let i=e[l],a=-1;for(let e in accounts)accounts[e].messages<20&&(a=e);function r(){$.ajax({url:`https://api.vk.com/method/messages.send?peer_id=${i}&random_id=${Random(0,999999999)}&message=${t[Random(0,t.length-1)]}&access_token=${n[a].token}&v=5.131`,method:"GET",dataType:"JSONP",success:function(e){if(e.error)s.push({user_id:i,token_id:n[a].id,status:!1,error:`${e.error.error_code}. ${e.error.error_msg}`});else{e.response.items;s.push({user_id:i,token_id:n[a].id,status:!0})}}})}setTimeout(r,o)}setTimeout((function(){let e=0,t=0,n="";for(let o in s)if(s[o].status)e+=1;else{t+=1,document.querySelector(".table_res-table").insertAdjacentHTML("beforeend",`<tr><td>${s[o].token_id}</td><td>${s[o].user_id}</td><td>${s[o].error}</td></tr>`),n+=s[o].user_id+"<br>"}document.querySelector(".table-number2").innerText=e,document.querySelector(".table-number3").innerText=t,document.querySelector("#result_items2").innerHTML=n}),1e3)}null==localStorage.getItem("tokens")&&localStorage.setItem("tokens",JSON.stringify([])),txt=1,list_tokens(),number_active_day();